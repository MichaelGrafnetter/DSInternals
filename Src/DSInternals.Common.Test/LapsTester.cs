using System;
using DSInternals.Common.Data;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace DSInternals.Common.Test
{
    [TestClass]
    public class LapsTester
    {
        [TestMethod]
        public void LAPS_Parse_Encrypted1()
        {
            byte[] rootKey = "a499ffbd0685ef2a7bf1f1c0465b58f58c86f50d1c0392e19e885207f4d86acd473f1b16d945f7eafb3c113e128c222c7aecea5221c46333d2e9e0c4fa890c87".HexToBinary();
            byte[] encryptedPassword = "4a93da018e799b34e3040000000000003082044d06092a864886f70d010703a082043e3082043a02010231820406a2820402020104308203c40482036c010000004b44534b030000006a0100000b00000012000000a400018b062628a36070c5cad7cf5c0b080300001800000018000000444850420001000087a8e61db4b6663cffbbd19c651959998ceef608660dd0f25d2ceed4435e3b00e00df8f1d61957d4faf7df4561b2aa3016c3d91134096faa3bf4296d830e9a7c209e0c6497517abd5a8a9d306bcf67ed91f9e6725b4758c022e0b1ef4275bf7b6c5bfc11d45f9088b941f54eb1e59bb8bc39a0bf12307f5c4fdb70c581b23f76b63acae1caa6b7902d52526735488a0ef13c6d9a51bfa4ab3ad8347796524d8ef6a167b5a41825d967e144e5140564251ccacb83e6b486f6b3ca3f7971506026c0b857f689962856ded4010abd0be621c3a3960a54e710c375f26375d7014103a4b54330c198af126116d2276e11715f693877fad7ef09cadb094ae91e1a15973fb32c9b73134d0b2e77506660edbd484ca7b18f21ef205407f4793a1a0ba12510dbc15077be463fff4fed4aac0bb555be3a6c1b0c6b47b1bc3773bf7e8c6f62901228f8c28cbb18a55ae31341000a650196f931c77a57f2ddf463e5e9ec144b777de62aaab8a8628ac376d282d6ed3864e67982428ebc831d14348f6f2f9193b5045af2767164e1dfc967c1fb3f2e55a4bd1bffe83b9c80d052b985d182ea0adb2a3b7313d3fe14c8484b1e052588b9b7d2bbd2df016199ecd06e1557cd0915b3353bbb64e0ec377fd028370df92b52c7891428cdc67eb6184b523d1db246c32f63078490f00ef8d647d148d47954515e2327cfef98c582664b4c0f6cc41659755560a0185297824876647fd50b5520168dbac7242405539588c0e182cf02b15a2df3ffa4e6992a57520594afb1784ec4f7451b0180c7a82b9f4c5131c9ba46c77aafd6991d3a878fb28b0cf1781d779cc1f47c4688ddf60ed71c52fe9474d8fa3267b02fa5a663d2fcd9400787db5b3a144b28ff5120e52415eb22363f10c00601824cb050d6a182da4af7980ecdb43469709c61d861d0478d314ec26b14122bcef77965935c26bb17b63565355fb92218165be6825b4b30398215c981a42536b6b289dcd684439b617dd5395eb9202f7288b05caf17275d326f4bb0d656c392ed2a6e49d578e59fb77dcc94c9a1c7759b6d04ddc24daadbde61791246fc9363006f006e0074006f0073006f002e0063006f006d00000063006f006e0074006f0073006f002e0063006f006d000000305206092b0601040182374a013045060a2b0601040182374a01013037303530330c035349440c2c532d312d352d32312d3233323338363535372d333535373130303634362d333536363833373133312d353132300b060960864801650304012d042835eb278aeb28e8825a5654d1dbbe2d8ebb98724baddd993be3982d291a8691346adb13757eacbcbe302b06092a864886f70d010701301e060960864801650304012e3011040c866ebfe3e515353ffa58fb47020110b20678904e1606195cd306df5719035ea167ad209ad0ea4b975e7cbebb7341af6534ecad0d2ba8328a6ab07c1c8270d60c784b4553a658c748a40ef88bee924821755407f1283b80e16b0ec5c682d95eb99f53b8e10dd3b60710fd1afab7f0bfdd3fe5f6ef19b5ea6e87a955df0d8292ca416b08c0022ec4a4ae7f0ea95c1ac6df365525459673e4142ad227973eaaf7b08b".HexToBinary();
            string expectedPassword = "yZB86rAk2t8084";

            byte[] x = "010000004B44534B030000006A0100000B00000012000000A400018B062628A36070C5CAD7CF5C0B080300001800000018000000444850420001000087A8E61DB4B6663CFFBBD19C651959998CEEF608660DD0F25D2CEED4435E3B00E00DF8F1D61957D4FAF7DF4561B2AA3016C3D91134096FAA3BF4296D830E9A7C209E0C6497517ABD5A8A9D306BCF67ED91F9E6725B4758C022E0B1EF4275BF7B6C5BFC11D45F9088B941F54EB1E59BB8BC39A0BF12307F5C4FDB70C581B23F76B63ACAE1CAA6B7902D52526735488A0EF13C6D9A51BFA4AB3AD8347796524D8EF6A167B5A41825D967E144E5140564251CCACB83E6B486F6B3CA3F7971506026C0B857F689962856DED4010ABD0BE621C3A3960A54E710C375F26375D7014103A4B54330C198AF126116D2276E11715F693877FAD7EF09CADB094AE91E1A15973FB32C9B73134D0B2E77506660EDBD484CA7B18F21EF205407F4793A1A0BA12510DBC15077BE463FFF4FED4AAC0BB555BE3A6C1B0C6B47B1BC3773BF7E8C6F62901228F8C28CBB18A55AE31341000A650196F931C77A57F2DDF463E5E9EC144B777DE62AAAB8A8628AC376D282D6ED3864E67982428EBC831D14348F6F2F9193B5045AF2767164E1DFC967C1FB3F2E55A4BD1BFFE83B9C80D052B985D182EA0ADB2A3B7313D3FE14C8484B1E052588B9B7D2BBD2DF016199ECD06E1557CD0915B3353BBB64E0EC377FD028370DF92B52C7891428CDC67EB6184B523D1DB246C32F63078490F00EF8D647D148D47954515E2327CFEF98C582664B4C0F6CC41659696C319CD71DF4CC1D27EBE9C51802B2EB2B2728782716AB5D144F9FE6D9C023B8BE3AD9763280AA4259FC1A7CC9BE85FBBDF76AD924D53C4C91E6CE541E9F3F652CB962D6D38385ACDF52EDFF5B5E5C06872BD3667C1751C0FA5C4A2FF44C1BA4A6F9DC3883A25F0777C93111E43598C12B542BB683C355E51B549821458197328FE150FAB20B3DA4ED965EC485D072D223E3F1BC20CB860079DEDB0386F41BCEE60EAFD00026D07A83818F538CB4F3D7399D511283D805DF1E991A4A2C4C165E84ED042538488F09D2B278C5F41E7ABA602E5056D12183C9F08968A0731596F0E4F8C7B82511AB7BBA4DE0F0D442876CE68E5B43F742E16BCACAF6A811206F63006F006E0074006F0073006F002E0063006F006D00000063006F006E0074006F0073006F002E0063006F006D000000".HexToBinary();
            // new ProtectionKeyIdentifier(x);
            // var laps = new LapsEncryptedPassword(encryptedPassword);

            throw new AssertInconclusiveException();
        }

        [TestMethod]
        public void LAPS_Parse_Cleartext()
        {
            byte[] binaryLapsPassword = "7b226e223a2241646d696e6973747261746f72222c2274223a22316438313631623431633431636465222c2270223a2241366133233725656221353762653461344239355a343333393462613935366465363965356438393735227d".HexToBinary();
            var rawLapsPassword = LapsClearTextPassword.Parse(binaryLapsPassword);
            LapsPasswordInformation laps = new LapsPasswordInformation("CONTOSO-PC1", rawLapsPassword, DateTime.Now);

            Assert.AreEqual("Administrator", laps.Account);
            Assert.AreEqual("A6a3#7%eb!57be4a4B95Z43394ba956de69e5d8975", laps.Password);
            Assert.AreEqual(LapsPasswordSource.CleartextPassword, laps.Source);
            Assert.AreEqual(LapsDecryptionStatus.NotApplicable, laps.DecryptionStatus);
        }
    }
}
