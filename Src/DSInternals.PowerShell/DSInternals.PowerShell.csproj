<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <!-- Target both Windows PowerShell 5 and PowerShell 7 -->
    <TargetFrameworks>net48;net8.0-windows</TargetFrameworks>
    <!-- Redirect the build directory so that it includes the module name -->
    <ArtifactsPivots>$(Configuration)/DSInternals/$(TargetFramework)</ArtifactsPivots>
    <IncludeSymbols>False</IncludeSymbols>
    <Version>6.0</Version>
    <AssemblyTitle>DSInternals PowerShell Commands</AssemblyTitle>
    <!-- Copy all dependency DLLs to the binary module -->
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
    <!-- XML documentation files are not needed for PowerShell binary modules -->
    <GenerateDocumentationFile>False</GenerateDocumentationFile>
    <!-- Do not generate the *.deps.json file, which is not needed by PowerShell Core -->
    <GenerateDependencyFile>False</GenerateDependencyFile>
    <!-- Skip copying XML files from the referenced projects -->
    <AllowedReferenceRelatedFileExtensions>.pdb</AllowedReferenceRelatedFileExtensions>
  </PropertyGroup>

  <ItemGroup>
    <!-- Include platform-independent module files in the module root directory -->
    <Content Include="*.psd1;*.psm1;**\*.ps1xml;*\*.txt;*\*.dll-Help.xml">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <TargetPath>../%(RecursiveDir)%(Filename)%(Extension)</TargetPath>
    </Content>
    <!-- Show MarkDown documentation files -->
    <None Include="$(MSBuildThisFileDirectory)../../Documentation/PowerShell/*.md">
      <Link>Documentation/%(Filename)%(Extension)</Link>
    </None>
    <!-- Pack the script template as an embedded resource -->
    <None Remove="ADDBRestoreFromMediaScriptTemplate.ps1" />
    <Resource Include="ADDBRestoreFromMediaScriptTemplate.ps1" />
  </ItemGroup>

  <ItemGroup>
    <!-- Reference assemblies that are bundled with PowerShell -->
    <PackageReference Include="PowerShellStandard.Library" Version="5.1.1" IncludeAssets="compile" />
    <!-- TODO: Get rid of the AutoMapper dependency -->
    <PackageReference Include="AutoMapper" Version="15.0.1" />
    <ProjectReference Include="..\DSInternals.Common\DSInternals.Common.csproj" />
    <ProjectReference Include="..\DSInternals.Datastore\DSInternals.Datastore.csproj" />
    <ProjectReference Include="..\DSInternals.Replication.Model\DSInternals.Replication.Model.csproj" />
    <ProjectReference Include="..\DSInternals.Replication\DSInternals.Replication.csproj" />
    <ProjectReference Include="..\DSInternals.SAM\DSInternals.SAM.csproj" />
  </ItemGroup>
</Project>
